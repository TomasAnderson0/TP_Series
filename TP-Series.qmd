---
format: pdf
editor: visual
lang: "es"
header-includes:
  - \usepackage{ragged2e}
  - \usepackage{hyperref}
---

\Centering

\vspace{3cm}

\pagenumbering{gobble}

\vspace{5cm}

\large

LICENCIATURA EN ESTADÍSTICA

\vspace{1cm}

\large
\Huge

"Series" \Huge \newline \vspace{0.3cm}

\normalsize

Trabajo Práctico 3 \vspace{1cm}

Autores: Tomás Anderson

Docentes:

05/06/2024 \normalsize

```{=tex}
\newpage
\hypersetup{linkcolor = black}
\tableofcontents
```
```{=tex}
\newpage
\pagenumbering{arabic}
```
```{=tex}
\RaggedRight
\newpage
```

## Introducción

Argentina se destaca como uno de los principales exportadores de productos agrícolas a nivel mundial, lo que convierte al sector agrícola en un pilar esencial de su economía. Este sector no solo contribuye significativamente al Producto Interno Bruto (PIB), sino que también genera un gran número de empleos, haciendo que su prosperidad sea fundamental para el desarrollo del país.

Una métrica clave para cuantificar la actividad económica de este sector es el Valor Agregado Bruto (VAB). Esta magnitud económica mide el valor añadido generado por los productores en un área específica, reflejando el valor que se agrega a los bienes y servicios en las diversas etapas del proceso productivo. En términos sencillos, el VAB se calcula restando el total de costos de producción del valor del producto final, proporcionando una visión clara de la contribución económica real del sector.

Este estudio se centrará en el análisis del VAB trimestral del sector de agricultura, ganadería, caza y silvicultura desde 2004 hasta la actualidad. El objetivo es modelar la evolución de esta métrica a lo largo del tiempo, lo que permitirá predecir el estado futuro del sector agrícola y su potencial desarrollo.

## Análisis descriptivo

Como primer medida se grafica el VAB a traves del tiempo para observar la estructura que presenta los datos.

```{r, warning=FALSE, echo=FALSE, message = FALSE, fig.cap = "Serie del VAB. Periodo 2004-2024"}
library(ggplot2)
library(dplyr)
library(readr)
library(plotly)
library(lubridate)
library(tsibble)
library(feasts)
library(forecast)
library(fpp3)
datos <- read_csv("producto-interno-bruto-valores-trimestrales-base-2004.csv")[1:78,1:2]
colnames(datos) = c("indice_tiempo", "agricultura")
options(scipen = 999)


ggplot(data = datos) + 
  aes(x = indice_tiempo, y = agricultura) +
  geom_line(color = "steelblue", size = .78) + 
  labs(x = "Años", y = "Millones de pesos (a precios de 2004)") + 
  scale_x_date(limits = c(as.Date("2004-01-01"),as.Date("2024-04-01")),
               breaks = seq(from = as.Date("2004-01-01"),
                            to = as.Date("2024-04-01"), by = "2 years"),
               date_labels = "%Y") + geom_point(color = "#D34343", size = 1)


```

Se puede observar en la figura 1 que el VAB trimestral no pareceria tener un comportamiento estacionario en media ya que muestra un incremento a lo largo del tiempo. Se destaca que los segundos trimestres de cada año son los períodos en los que se generan mayores ingresos en los sectores de agricultura, ganadería, caza y silvicultura. Además, la variabilidad del VAB no parece estar relacionada con el tiempo.

```{r, warning=FALSE, echo=FALSE, message = FALSE, fig.cap="Comportamiento anual del VAB"}
datos_t <- datos %>% mutate(indice_tiempo = yearquarter(indice_tiempo)) %>% as_tsibble(index = indice_tiempo)

gg_season(datos_t, agricultura, labels = "both") + labs(x = "Años", y = "VAB") + theme_bw()


```








```{r, warning=FALSE, echo=FALSE, message = FALSE, fig.cap="Comportamiento del"}

gg_subseries(datos_t, agricultura) + labs(x = "Trimestres", y = "VAB") + theme_bw()



```

```{r, warning=FALSE, echo=FALSE, message = FALSE, fig.cap = "Autocorrelacion muestral"}
bacf <- acf(datos$agricultura, plot = FALSE, lag.max = 70)
bacfdf <- with(bacf, data.frame(lag, acf))
ciline <- qnorm((1 - .95)/2)/sqrt(length(datos$agricultura))
ggplot(data=bacfdf, mapping=aes(x=lag, y=acf)) +
       geom_hline(aes(yintercept = 0)) +
       geom_segment(mapping = aes(xend = lag, yend = 0), color = "salmon") + 
  geom_hline(aes(yintercept = ciline), linetype = 2, color = 'blue') +
  geom_hline(aes(yintercept = -ciline), linetype = 2, color = 'blue') +
  scale_y_continuous(breaks = seq(-.4,1,.2)) +
  scale_x_continuous(breaks = seq(0,80,10)) +
  labs(y = "Autocorrelacion", x = "Rezagos")



```

```{r, warning=FALSE, echo=FALSE, message = FALSE, fig.cap = "Autocorrelacion parcial muestral"}
bacf <- pacf(datos$agricultura, plot = FALSE, lag.max = 70)
bacfdf <- with(bacf, data.frame(lag, acf))
ciline <- qnorm((1 - .95)/2)/sqrt(length(datos$agricultura))
ggplot(data=bacfdf, mapping=aes(x=lag, y=acf)) +
       geom_hline(aes(yintercept = 0)) +
       geom_segment(mapping = aes(xend = lag, yend = 0), color = "salmon") + 
  geom_hline(aes(yintercept = ciline), linetype = 2, color = 'blue') +
  geom_hline(aes(yintercept = -ciline), linetype = 2, color = 'blue') +
  scale_y_continuous(breaks = seq(-.4,1,.2)) +
  scale_x_continuous(breaks = seq(0,80,10)) +
  labs(y = "Autocorrelacion", x = "Rezagos")

```

```{r, warning=FALSE, echo=FALSE, message = FALSE, eval=FALSE}
tsData = ts(datos$agricultura, start = c(2004,1), frequency = 4)
auto.arima(y = tsData)
```

```{r, warning=FALSE, echo=FALSE, message = FALSE}
datos = datos %>%  mutate(agricultura_dif_4 = difference(agricultura, 4))

ggplot(data = datos) + 
  aes(x = indice_tiempo, y = agricultura_dif_4) +
  geom_line(color = "steelblue", size = .78) + 
  labs(x = "Años", y = "Millones de pesos (a precios de 2004)") + 
  scale_x_date(limits = c(as.Date("2004-01-01"),as.Date("2024-04-01")),
               breaks = seq(from = as.Date("2004-01-01"),
                            to = as.Date("2024-04-01"), by = "2 years"),
               date_labels = "%Y") + geom_point(color = "#D34343", size = 1)

datos_t_4 <- datos[,c(1,3)] %>% mutate(indice_tiempo = yearquarter(indice_tiempo)) %>% as_tsibble(index = indice_tiempo)



datos_t_4 %>% 
  gg_season(agricultura_dif_4, labels = "both") + labs(x = "Años", y = "VAB") + theme_bw()
datos_t_4 %>% 
gg_subseries(agricultura_dif_4) + labs(x = "Trimestres", y = "VAB") + theme_bw()



```

```{r, warning=FALSE, echo=FALSE, message = FALSE}
bacf <- acf(datos$agricultura_dif_4[-c(1,2,3,4)], plot = FALSE, lag.max = 70)
bacfdf <- with(bacf, data.frame(lag, acf))
ciline <- qnorm((1 - .95)/2)/sqrt(length(datos$agricultura_dif_4[-c(1,2,3,4)]))
ggplot(data=bacfdf, mapping=aes(x=lag, y=acf)) +
       geom_hline(aes(yintercept = 0)) +
       geom_segment(mapping = aes(xend = lag, yend = 0), color = "salmon") + 
  geom_hline(aes(yintercept = ciline), linetype = 2, color = 'blue') +
  geom_hline(aes(yintercept = -ciline), linetype = 2, color = 'blue') +
  scale_y_continuous(breaks = seq(-.4,1,.2)) +
  scale_x_continuous(breaks = seq(0,80,10)) +
  labs(y = "Autocorrelacion", x = "Rezagos")



bacf <- pacf(datos$agricultura_dif_4[-c(1,2,3,4)], plot = FALSE, lag.max = 70)
bacfdf <- with(bacf, data.frame(lag, acf))
ciline <- qnorm((1 - .95)/2)/sqrt(length(datos$agricultura_dif_4[-c(1,2,3,4)]))
ggplot(data=bacfdf, mapping=aes(x=lag, y=acf)) +
       geom_hline(aes(yintercept = 0)) +
       geom_segment(mapping = aes(xend = lag, yend = 0), color = "salmon") + 
  geom_hline(aes(yintercept = ciline), linetype = 2, color = 'blue') +
  geom_hline(aes(yintercept = -ciline), linetype = 2, color = 'blue') +
  scale_y_continuous(breaks = seq(-.4,1,.2)) +
  scale_x_continuous(breaks = seq(0,80,10)) +
  labs(y = "Autocorrelacion", x = "Rezagos")
```

```{r}
modelo = datos_t %>% model(arima = ARIMA(agricultura ~ pdq(0,0,0) + PDQ(0,1,1)))
report(modelo)
gg_tsresiduals(modelo)
```

```{r}
augment(modelo) |>
  features(.innov, ljung_box)
```


